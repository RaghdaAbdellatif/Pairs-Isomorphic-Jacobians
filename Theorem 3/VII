Q := RationalField();
T<t>  := PolynomialRing(Q);
TF<s> := FunctionField(Q);




E := EllipticCurveFromjInvariant((s^2+13*s+49)*(s^2+5*s+1)^3/s) ;
E;
a1:=1;
a2:=0;
a3:=0;
a4:=- 36*s/(s^8 + 28*s^7 + 322*s^6 +
    1904*s^5 + 5915*s^4 + 8624*s^3 + 4018*s^2 - 980*s + 49);
a6:=- s/(s^8 + 28*s^7
    + 322*s^6 + 1904*s^5 + 5915*s^4 + 8624*s^3 + 4018*s^2 - 980*s + 49);

b2:=a1^2+4*a2;
b4:=a1*a3+2*a4;
b6:=a3^2+4*a6;



E0 := EllipticCurve([0,b2/4,0,b4/2,b6/4]);
E0;
jInvariant(E0);
IsTwist(E,E0);
Discriminant(E0);

//replace s<>s^2 cubic galois

ss := s^2;
E1 := EllipticCurve([0,1/4,0, - 36*ss/(ss^8 + 28*ss^7 + 322*ss^6 +
    1904*ss^5 + 5915*ss^4 + 8624*ss^3 + 4018*ss^2 - 980*ss + 49), - ss/(ss^8 + 28*ss^7
    + 322*ss^6 + 1904*ss^5 + 5915*ss^4 + 8624*ss^3 + 4018*ss^2 - 980*ss + 49) ]);

Factorization(DivisionPolynomial(E1,7));

X1<x1> := ext<TF|>;
F1<f1> := ext<TF|x1^3 + (-s^6 - 13*s^4 - 47*s^2 - 14)/(s^8 + 14*s^6 + 63*s^4 + 70*s^2 -
        7)*x1^2 + (s^10 + 19*s^8 + 133*s^6 + 373*s^4 + 271*s^2 + 49)/(s^16 +
        28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4 -
        980*s^2 + 49)*x1 + (-s^12 - 21*s^10 - 166*s^8 - 569*s^6 - 750*s^4 -
        349*s^2 - 49)/(s^24 + 42*s^22 + 777*s^20 + 8246*s^18 + 54810*s^16 +
        233730*s^14 + 628425*s^12 + 999306*s^10 + 801738*s^8 + 159838*s^6 -
        93639*s^4 + 10290*s^2 - 343)>;



X2<x2> := ext<F1|>;
F2<f2> := ext<F1|x2^2-(f1^3 + 1/4*f1^2 - 36*s^2/(s^16 + 28*s^14 +
    322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4 - 980*s^2 + 49)*f1 -
    s^2/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4
    - 980*s^2 + 49))>;


EE := BaseExtend(E1,F2);
Q := EE![f1,f2];

R<z> := PolynomialRing(F2);
f := z - Q[1];
IsogenyFromKernel(EE, &*{(z-(n*Q)[1]) : n in [1..Order(Q)-1]});

EEI := EllipticCurve([0,1/4,0,(-5*s^14 - 165*s^12 - 2180*s^10 - 14555*s^8 - 49820*s^6 - 75215*s^4 -
    25431*s^2 - 2450)/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 +
    8624*s^6 + 4018*s^4 - 980*s^2 + 49),(-s^22 - 61*s^20 - 1563*s^18 -
    22420*s^16 - 199153*s^14 - 1132425*s^12 - 4079892*s^10 - 8795374*s^8 -
    9879408*s^6 - 4152015*s^4 - 725788*s^2 - 45276)/(s^24 + 42*s^22 + 777*s^20 +
    8246*s^18 + 54810*s^16 + 233730*s^14 + 628425*s^12 + 999306*s^10 +
    801738*s^8 + 159838*s^6 - 93639*s^4 + 10290*s^2 - 343)]);

jInvariant(EEI);
Discriminant(EEI);



R<r>  := ext<TF|>;
R<r1> := ext<TF|r^3 + 1/4*r^2 - 36*s^2/(s^16 + 28*s^14 +
    322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4 - 980*s^2 + 49)*r -
    s^2/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4
    - 980*s^2 + 49)>;

D<d> := ext<R|>;

Factorization(d^3 + 1/4*d^2 - 36*s^2/(s^16 + 28*s^14 +
    322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4 - 980*s^2 + 49)*d -
    s^2/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 + 4018*s^4
    - 980*s^2 + 49));

Rz<z> := ext<R|>;

H := (z^7 + (-2*s^6 - 26*s^4 - 94*s^2 - 28)/(s^8 + 14*s^6 +
    63*s^4 + 70*s^2 - 7)*z^6 + (s^14 + 34*s^12 + 464*s^10 + 3212*s^8 + 11480*s^6
    + 18362*s^4 + 6937*s^2 + 784)/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 +
    5915*s^8 + 8624*s^6 + 4018*s^4 - 980*s^2 + 49)*z^5 + (-6*s^18 - 218*s^16 -
    3400*s^14 - 29206*s^12 - 147372*s^10 - 428870*s^8 - 648958*s^6 - 397084*s^4
    - 97300*s^2 - 8232)/(s^24 + 42*s^22 + 777*s^20 + 8246*s^18 + 54810*s^16 +
    233730*s^14 + 628425*s^12 + 999306*s^10 + 801738*s^8 + 159838*s^6 -
    93639*s^4 + 10290*s^2 - 343)*z^4 + (s^24 + 50*s^22 + 1132*s^20 + 15136*s^18
    + 130999*s^16 + 757090*s^14 + 2908984*s^12 + 7163268*s^10 + 10472149*s^8 +
    8059870*s^6 + 3157378*s^4 + 587356*s^2 + 41160)/(s^32 + 56*s^30 + 1428*s^28
    + 21840*s^26 + 222138*s^24 + 1574664*s^22 + 7925456*s^20 + 28301224*s^18 +
    70360227*s^16 + 116694088*s^14 + 118206032*s^12 + 57895656*s^10 - 179046*s^8
    - 7030128*s^6 + 1354164*s^4 - 96040*s^2 + 2401)*z^3 + (-6*s^26 - 298*s^24 -
    6640*s^22 - 87018*s^20 - 738980*s^18 - 4223398*s^16 - 16333860*s^14 -
    41916342*s^12 - 68300972*s^10 - 66314754*s^8 - 36619576*s^6 - 11153702*s^4 -
    1727250*s^2 - 105644)/(s^40 + 70*s^38 + 2275*s^36 + 45430*s^34 + 621775*s^32
    + 6160084*s^30 + 45484250*s^28 + 253858220*s^26 + 1074552605*s^24 +
    3428473650*s^22 + 8110225053*s^20 + 13791614970*s^18 + 15933404725*s^16 +
    11095453180*s^14 + 3116906170*s^12 - 841838620*s^10 - 406885465*s^8 +
    137985470*s^6 - 16050685*s^4 + 840350*s^2 - 16807)*z^2 + (s^30 + 58*s^28 +
    1541*s^26 + 24686*s^24 + 264086*s^22 + 1974438*s^20 + 10496441*s^18 +
    39624466*s^16 + 104485206*s^14 + 186777178*s^12 + 217632921*s^10 +
    159191354*s^8 + 70375445*s^6 + 18024468*s^4 + 2440788*s^2 + 134456)/(s^48 +
    84*s^46 + 3318*s^44 + 81760*s^42 + 1406013*s^40 + 17885784*s^38 +
    174061426*s^36 + 1321929252*s^34 + 7920928890*s^32 + 37606054892*s^30 +
    141257355918*s^28 + 416770280472*s^26 + 952431479909*s^24 +
    1646751300600*s^22 + 2070899220894*s^20 + 1760605424060*s^18 +
    849320352090*s^16 + 81921015540*s^14 - 104465084990*s^12 - 14119896840*s^10
    + 11507736093*s^8 - 2036739488*s^6 + 170120454*s^4 - 7058940*s^2 + 117649)*z
    + (-6*s^30 - 310*s^28 - 7236*s^26 - 100334*s^24 - 914570*s^22 - 5731080*s^20
    - 25106038*s^18 - 76801362*s^16 - 161767794*s^14 - 229385496*s^12 -
    213866590*s^10 - 128560794*s^8 - 48375404*s^6 - 10880282*s^4 - 1327410*s^2 -
    67228)/(s^56 + 98*s^54 + 4557*s^52 + 133574*s^50 + 2765560*s^48 +
    42952518*s^46 + 518741195*s^44 + 4983442198*s^42 + 38635971045*s^40 +
    243839701560*s^38 + 1258077262134*s^36 + 5308766239056*s^34 +
    18263406169561*s^32 + 50862092219078*s^30 + 113313718805175*s^28 +
    198251338084702*s^26 + 264570017887889*s^24 + 256326234018960*s^22 +
    163295696452182*s^20 + 50812579570200*s^18 - 6978242550867*s^16 -
    8616484993186*s^14 + 439505957611*s^12 + 778440844062*s^10 -
    212507035720*s^8 + 25722542062*s^6 - 1677557091*s^4 + 57648010*s^2 -
    823543)) / (z^6 + (-2*s^6 - 26*s^4 - 94*s^2 - 28)/(s^8 + 14*s^6 + 63*s^4 +
    70*s^2 - 7)*z^5 + (s^12 + 28*s^10 + 301*s^8 + 1516*s^6 + 3319*s^4 + 1858*s^2
    + 294)/(s^16 + 28*s^14 + 322*s^12 + 1904*s^10 + 5915*s^8 + 8624*s^6 +
    4018*s^4 - 980*s^2 + 49)*z^4 + (-2*s^16 - 64*s^14 - 856*s^12 - 6060*s^10 -
    23606*s^8 - 47068*s^6 - 38692*s^4 - 12892*s^2 - 1470)/(s^24 + 42*s^22 +
    777*s^20 + 8246*s^18 + 54810*s^16 + 233730*s^14 + 628425*s^12 + 999306*s^10
    + 801738*s^8 + 159838*s^6 - 93639*s^4 + 10290*s^2 - 343)*z^3 + (s^20 +
    40*s^18 + 695*s^16 + 6772*s^14 + 39861*s^12 + 142100*s^10 + 291409*s^8 +
    310804*s^6 + 165075*s^4 + 40936*s^2 + 3773)/(s^32 + 56*s^30 + 1428*s^28 +
    21840*s^26 + 222138*s^24 + 1574664*s^22 + 7925456*s^20 + 28301224*s^18 +
    70360227*s^16 + 116694088*s^14 + 118206032*s^12 + 57895656*s^10 - 179046*s^8
    - 7030128*s^6 + 1354164*s^4 - 96040*s^2 + 2401)*z^2 + (-2*s^22 - 80*s^20 -
    1396*s^18 - 13778*s^16 - 83486*s^14 - 315868*s^12 - 729364*s^10 - 978862*s^8
    - 735650*s^6 - 299212*s^4 - 60760*s^2 - 4802)/(s^40 + 70*s^38 + 2275*s^36 +
    45430*s^34 + 621775*s^32 + 6160084*s^30 + 45484250*s^28 + 253858220*s^26 +
    1074552605*s^24 + 3428473650*s^22 + 8110225053*s^20 + 13791614970*s^18 +
    15933404725*s^16 + 11095453180*s^14 + 3116906170*s^12 - 841838620*s^10 -
    406885465*s^8 + 137985470*s^6 - 16050685*s^4 + 840350*s^2 - 16807)*z + (s^24
    + 42*s^22 + 773*s^20 + 8110*s^18 + 52954*s^16 + 221106*s^14 + 587517*s^12 +
    971426*s^10 + 975930*s^8 + 579262*s^6 + 195301*s^4 + 34202*s^2 + 2401)/(s^48
    + 84*s^46 + 3318*s^44 + 81760*s^42 + 1406013*s^40 + 17885784*s^38 +
    174061426*s^36 + 1321929252*s^34 + 7920928890*s^32 + 37606054892*s^30 +
    141257355918*s^28 + 416770280472*s^26 + 952431479909*s^24 +
    1646751300600*s^22 + 2070899220894*s^20 + 1760605424060*s^18 +
    849320352090*s^16 + 81921015540*s^14 - 104465084990*s^12 - 14119896840*s^10 
    + 11507736093*s^8 - 2036739488*s^6 + 170120454*s^4 - 7058940*s^2 + 117649));


s1 := Evaluate(H, r1) ;

r2 := -( (-1/4*s^8 - 7/2*s^6 - 63/4*s^4 - 35/2*s^2 + 7/4)/s*r1^2 + (-1/16*s^8 -
        7/8*s^6 - 63/16*s^4 - 35/8*s^2 + 1/2*s + 7/16)/s*r1 + (1/8*s^8 + 7/4*s^6
        + 63/8*s^4 + 35/4*s^2 + 6*s - 7/8)/(s^8 + 14*s^6 + 63*s^4 + 70*s^2 - 7));


s2 := Evaluate(H, r2);

r3 := -( (1/4*s^8 + 7/2*s^6 + 63/4*s^4 + 35/2*s^2 - 7/4)/s*r1^2 + (1/16*s^8 +
        7/8*s^6 + 63/16*s^4 + 35/8*s^2 + 1/2*s - 7/16)/s*r1 + (1/8*s^8 + 7/4*s^6
        + 63/8*s^4 + 35/4*s^2 - 6*s - 7/8)/(s^8 + 14*s^6 + 63*s^4 + 70*s^2 - 7));

s3 := Evaluate(H, r3);



a1 := r1;
a2 := r2;
a3 := r3;

b1  := s2;
b2  :=s3;
b3  :=s1;
b1t :=s3;
b2t :=s1;
b3t :=s2;

g21  := (b2-b1)/(a2-a1);
g21t := (b2t-b1t)/(a2-a1);
g13  := (b1-b3)/(a1-a3);
g13t := (b1t-b3t)/(a1-a3);
g32  := (b3-b2)/(a3-a2);
g32t := (b3t-b2t)/(a3-a2);


delg := Discriminant(EEI);


g21*g13*g32;
g21+g13+g32;
g21*g13+g32*g21+g13*g32;


ac2   := a1*(b3-b2)+a2*(b1-b3)+a3*(b2-b1);
beta  := (b3-b2)*(b2-b1)*(b1-b3);
kappa := (delg^3*ac2^3)/((g21*g13*g32)^3*beta);
kappa;


g21t*g13t*g32t;
g21t+g13t+g32t;
g21t*g13t+g32t*g21t+g13t*g32t;

ac2t   := a1*(b3t-b2t)+a2*(b1t-b3t)+a3*(b2t-b1t);
betat  := (b3t-b2t)*(b2t-b1t)*(b1t-b3t);
kappat := (delg^3*ac2t^3)/((g21t*g13t*g32t)^3*betat);
kappat;


