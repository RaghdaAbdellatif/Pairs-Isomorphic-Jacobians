Q := RationalField();
T<t>  := PolynomialRing(Q);
TF<s> := FunctionField(Q);




E := EllipticCurveFromjInvariant((s^2+13*s+49)*(s^2+5*s+1)^3/s) ;

WeierstrassModel(E); 
E0 := EllipticCurve([(-27*s^8 - 756*s^7 - 8694*s^6 - 51408*s^5
    - 159705*s^4 - 232848*s^3 - 108486*s^2 - 20196*s - 1323),
 (54*s^8 + 1512*s^7 + 17388*s^6 + 102816*s^5 + 319410*s^4 + 465696*s^3 +
    216972*s^2 + 40392*s + 2646)*(s^4 + 14*s^3 + 63*s^2 + 70*s - 7)]);

IsTwist(E,E0);
Discriminant(E0);

//replace s<>s^2 cubic galois

ss := s^2;
E1 := EllipticCurve([(-27*ss^8 - 756*ss^7 - 8694*ss^6 - 51408*ss^5
    - 159705*ss^4 - 232848*ss^3 - 108486*ss^2 - 20196*ss - 1323),
 (54*ss^8 + 1512*ss^7 + 17388*ss^6 + 102816*ss^5 + 319410*ss^4 + 465696*ss^3 +
    216972*ss^2 + 40392*ss + 2646)*(ss^4 + 14*ss^3 + 63*ss^2 + 70*ss - 7)]);

Factorization(DivisionPolynomial(E1,7));

X1<x1> := ext<TF|>;
F1<f1> := ext<TF|x1^3 + (-9*s^8 - 162*s^6 - 1035*s^4 - 2322*s^2 - 441)*x1^2 + (27*s^16 +
        972*s^14 + 14526*s^12 + 115776*s^10 + 521505*s^8 + 1282176*s^6 +
        1473390*s^4 + 465372*s^2 + 43659)*x1 - 27*s^24 - 1458*s^22 - 34263*s^20
        - 464022*s^18 - 4012254*s^16 - 23073498*s^14 - 88792767*s^12 -
        223375482*s^10 - 346140702*s^8 - 293998518*s^6 - 111578391*s^4 -
        18821970*s^2 - 1165563>;



X2<x2> := ext<F1|>;
F2<f2> := ext<F1|x2^2-(f1^3 + (-27*ss^8 - 756*ss^7 - 8694*ss^6 - 51408*ss^5
    - 159705*ss^4 - 232848*ss^3 - 108486*ss^2 - 20196*ss - 1323)*f1 + (54*ss^12 +
    2268*ss^11 + 41958*ss^10 + 445284*ss^9 + 2959740*ss^8 + 12621420*ss^7 +
    33934950*ss^6 + 54055836*ss^5 + 44600220*ss^4 + 14509908*ss^3 + 1475334*ss^2 -
    97524*ss - 18522))>;


EE := BaseExtend(E1,F2);
Q := EE![f1,f2];

R<z> := PolynomialRing(F2);
f := z - Q[1];
IsogenyFromKernel(EE, &*{(z-(n*Q)[1]) : n in [1..Order(Q)-1]});

EEI := EllipticCurve([(-27*s^16 - 7236*s^14 - 222534*s^12 -
    2876688*s^10 - 19022985*s^8 - 64799568*s^6 - 97587126*s^4 - 32932116*s^2 -
    3176523), (54*s^24 - 24948*s^22 - 1890378*s^20 - 53796204*s^18 -
    826039620*s^16 - 7714354788*s^14 - 45642269610*s^12 - 169999432020*s^10 -
    377333544420*s^8 - 435447885852*s^6 - 188247106026*s^4 - 33887147364*s^2 -
    2179094778)]);

jInvariant(EEI);
Discriminant(EEI);



R<r>  := ext<TF|>;
R<r1> := ext<TF|r^3 + (-27*ss^8 - 756*ss^7 - 8694*ss^6 - 51408*ss^5
    - 159705*ss^4 - 232848*ss^3 - 108486*ss^2 - 20196*ss - 1323)*r + (54*ss^12 +
    2268*ss^11 + 41958*ss^10 + 445284*ss^9 + 2959740*ss^8 + 12621420*ss^7 +
    33934950*ss^6 + 54055836*ss^5 + 44600220*ss^4 + 14509908*ss^3 + 1475334*ss^2 -
    97524*ss - 18522)>;

D1<d1> := ext<R|>;

Factorization(d1^3 + (-27*ss^8 - 756*ss^7 - 8694*ss^6 - 51408*ss^5
    - 159705*ss^4 - 232848*ss^3 - 108486*ss^2 - 20196*ss - 1323)*d1 + (54*ss^12 +
    2268*ss^11 + 41958*ss^10 + 445284*ss^9 + 2959740*ss^8 + 12621420*ss^7 +
    33934950*ss^6 + 54055836*ss^5 + 44600220*ss^4 + 14509908*ss^3 + 1475334*ss^2 -
    97524*ss - 18522));

Rz<z> := ext<R|>;

H := (z^7 + (-18*s^8 - 324*s^6 - 2070*s^4 - 4644*s^2 -
    882)*z^6 + (135*s^16 + 6156*s^14 + 116694*s^12 + 1173744*s^10 + 6647157*s^8
    + 20427120*s^6 + 28747062*s^4 + 9561132*s^2 + 916839)*z^5 + (-540*s^24 -
    48600*s^22 - 1614492*s^20 - 28817640*s^18 - 316635480*s^16 - 2266516728*s^14
    - 10730436444*s^12 - 33001553304*s^10 - 62194326552*s^8 - 63088869384*s^6 -
    25959950172*s^4 - 4564635768*s^2 - 289647036)*z^4 + (1215*s^32 + 204120*s^30
    + 9989244*s^28 + 256635216*s^26 + 4159137942*s^24 + 46202455080*s^22 +
    366694966512*s^20 + 2118186597096*s^18 + 8925671195469*s^16 +
    27097055798184*s^14 + 57540480404976*s^12 + 81015574807656*s^10 +
    69099006710358*s^8 + 31243337269200*s^6 + 7436402318268*s^4 +
    887648846616*s^2 + 42029483391)*z^3 + (-1458*s^40 - 481140*s^38 -
    31712958*s^36 - 1064832804*s^34 - 22746559806*s^32 - 340737696792*s^30 -
    3768533846820*s^28 - 31677083041032*s^26 - 205516714563594*s^24 -
    1035260165782620*s^22 - 4041027252926370*s^20 - 12105308881597500*s^18 -
    27324962482429098*s^16 - 45146178569238984*s^14 - 52285826175960996*s^12 -
    39959631740687832*s^10 - 18811978503541470*s^8 - 5337151230748932*s^6 -
    888913130470974*s^4 - 80115533889300*s^2 - 3019138991442)*z^2 + (729*s^48 +
    603612*s^46 + 50690286*s^44 + 2103555744*s^42 + 55688453613*s^40 +
    1046769216264*s^38 + 14790408594570*s^36 + 162473385059676*s^34 +
    1416406629421962*s^32 + 9918928215205668*s^30 + 56135590705589382*s^28 +
    257044438961312040*s^26 + 949216869584454789*s^24 + 2805417108024243048*s^22
    + 6554048326824430566*s^20 + 11886858794603943684*s^18 +
    16325936654773618890*s^16 + 16431925499783268156*s^14 +
    11641651423959293802*s^12 + 5575868615894403528*s^10 +
    1766012071224676653*s^8 + 362586267038505888*s^6 + 46340650193180238*s^4 +
    3350333297267964*s^2 + 104726694667833)*z + (-314928*s^54 - 32437584*s^52 -
    1603928304*s^50 - 50610189312*s^48 - 1142510600016*s^46 -
    19605586603536*s^44 - 265218505082928*s^42 - 2894701999060800*s^40 -
    25876660721919552*s^38 - 191265626620778976*s^36 - 1175257430828254080*s^34
    - 6016191048643935456*s^32 - 25639132947192323280*s^30 -
    90663625501784189712*s^28 - 264428849841768775152*s^26 -
    630492585519208157568*s^24 - 1214172604398601789056*s^22 -
    1858662412469795184480*s^20 - 2216429804591844864192*s^18 -
    2008718806529754269856*s^16 - 1345582173683248996752*s^14 -
    648818650581361659792*s^12 - 221016118875803412336*s^10 -
    52316211878177921280*s^8 - 8391570338905515216*s^6 - 868915024323412752*s^4
    - 52395213564641808*s^2 - 1397932881982560)) / (z^6 + (-18*s^8 - 324*s^6 -
    2070*s^4 - 4644*s^2 - 882)*z^5 + (135*s^16 + 4860*s^14 + 73926*s^12 +
    608688*s^10 + 2874501*s^8 + 7513776*s^6 + 9251334*s^4 + 2978748*s^2 +
    281799)*z^4 + (-540*s^24 - 29160*s^22 - 700812*s^20 - 9855864*s^18 -
    89529624*s^16 - 546166152*s^14 - 2249522604*s^12 - 6110593992*s^10 -
    10308157848*s^8 - 9538764984*s^6 - 3774248460*s^4 - 650854440*s^2 -
    40838364)*z^3 + (1215*s^32 + 87480*s^30 + 2874204*s^28 + 57087504*s^26 +
    764517366*s^24 + 7282789704*s^22 + 50691545712*s^20 + 260488634184*s^18 +
    985667198445*s^16 + 2704626895176*s^14 + 5219208140400*s^12 +
    6723349293384*s^10 + 5317504269174*s^8 + 2300121807120*s^6 +
    533458651356*s^4 + 62649204408*s^2 + 2934134847)*z^2 + (-1458*s^40 -
    131220*s^38 - 5468958*s^36 - 140274180*s^34 - 2479893246*s^32 -
    32050170072*s^30 - 313213954788*s^28 - 2360215631304*s^26 -
    13852317304458*s^24 - 63492529590972*s^22 - 226395099597762*s^20 -
    621354933922140*s^18 - 1288674362473578*s^16 - 1963551746709000*s^14 -
    2110344286248036*s^12 - 1514049696242712*s^10 - 682140491763678*s^8 -
    187975399114404*s^6 - 30695895328158*s^4 - 2728337545332*s^2 -
    101774630034)*z + (729*s^48 + 78732*s^46 + 3975966*s^44 + 124968096*s^42 +
    2743703037*s^40 + 44743273128*s^38 + 562337263674*s^36 + 5575664759724*s^34
    + 44266071193290*s^32 + 283889314433268*s^30 + 1476789817563702*s^28 +
    6231704528956680*s^26 + 21250416307458357*s^24 + 58105644153182856*s^22 +
    125846244975592566*s^20 + 212149702418128308*s^18 + 271850145504640074*s^16
    + 256773757380258924*s^14 + 172294494133382010*s^12 + 79158579401147688*s^10
    + 24323897499920253*s^8 + 4885597845371808*s^6 + 614369842979166*s^4 +
    43876383638220*s^2 + 1358537106969)) ;


s1 := Evaluate(H, r1) ;

r2 := -(- 1/144/s*r1^2 + (-1/48*s^8 - 7/24*s^6 - 21/16*s^4 - 35/24*s^2 + 1/2*s +
        7/48)/s*r1 + (1/8*s^16 + 7/2*s^14 + 161/4*s^12 + 238*s^10 + 5915/8*s^8 +
        1078*s^6 + 2009/4*s^4 + 187/2*s^2 + 49/8)/s);


s2 := Evaluate(H, r2);

r3 := -( 1/144/s*r1^2 + (1/48*s^8 + 7/24*s^6 + 21/16*s^4 + 35/24*s^2 + 1/2*s -
        7/48)/s*r1 + (-1/8*s^16 - 7/2*s^14 - 161/4*s^12 - 238*s^10 - 5915/8*s^8
        - 1078*s^6 - 2009/4*s^4 - 187/2*s^2 - 49/8)/s);

s3 := Evaluate(H, r3);



a1 := r1;
a2 := r2;
a3 := r3;

b1  := s2;
b2  :=s3;
b3  :=s1;
b1t :=s3;
b2t :=s1;
b3t :=s2;

g21  := (b2-b1)/(a2-a1);
g21t := (b2t-b1t)/(a2-a1);
g13  := (b1-b3)/(a1-a3);
g13t := (b1t-b3t)/(a1-a3);
g32  := (b3-b2)/(a3-a2);
g32t := (b3t-b2t)/(a3-a2);


delg := Discriminant(EEI);


g21*g13*g32;
g21+g13+g32;
g21*g13+g32*g21+g13*g32;


ac2   := a1*(b3-b2)+a2*(b1-b3)+a3*(b2-b1);
beta  := (b3-b2)*(b2-b1)*(b1-b3);
kappa := (delg^3*ac2^3)/((g21*g13*g32)^3*beta);
kappa;


g21t*g13t*g32t;
g21t+g13t+g32t;
g21t*g13t+g32t*g21t+g13t*g32t;

ac2t   := a1*(b3t-b2t)+a2*(b1t-b3t)+a3*(b2t-b1t);
betat  := (b3t-b2t)*(b2t-b1t)*(b1t-b3t);
kappat := (delg^3*ac2t^3)/((g21t*g13t*g32t)^3*betat);
kappat;


